trigger:
  - main  # Trigger pipeline on changes to the main branch

pool:
  name: Default  # Using the default agent pool, assuming self-hosted agent is used

variables:
  mysqlHost: 'localhost'  # Use localhost if MySQL is installed on the same machine
  mysqlUser: 'root'  # MySQL user
  mysqlPassword: $(MYSQL_PASSWORD)  # Using a secure variable for the password
  databaseName: 'my_database'  # Name of the database to use
  sqlFile: 'setup.sql'  # Name of your SQL file

steps:
  - checkout: self  # Checkout the repository (this pulls your setup.sql file)

  - script: |
      echo "Installing MySQL client..."
      sudo apt-get update
      sudo apt-get install mysql-client -y  # Install MySQL client on the build agent
    displayName: 'Install MySQL Client'

  - script: |
      echo "Running SQL script..."
      mysql -h $(mysqlHost) -u $(mysqlUser) -p$(mysqlPassword) $(databaseName) < $(Build.SourcesDirectory)/$(sqlFile)
    displayName: 'Run SQL Script'
    condition: succeeded()  # Run only if the previous step was successful
